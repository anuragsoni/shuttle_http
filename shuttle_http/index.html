<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>index (shuttle_http.index)</title><link rel="stylesheet" href="../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ shuttle_http</nav><header class="odoc-preamble"><h1 id="shuttle_http"><a href="#shuttle_http" class="anchor"></a>Shuttle_http</h1><p>Shuttle_http is a low level library for implementing HTTP/1.1 web services in OCaml using the <a href="https://opensource.janestreet.com/async/">Async</a> library for lightweight concurrency. It allows defining services as simple OCaml <a href="Shuttle_http/Server/index.html#type-service">functions</a>, and supports streaming bodies to allow working with large bodies incrementally.</p><p>It supports error reporting using <a href="Shuttle_http/Server/index.html#type-error_handler">error handlers</a> and provides a default implementation that responds with the error status code and an empty response body. Users can provide their own error handler implementation when setting up a <a href="Shuttle_http/Server/Config/index.html#val-create">server config</a>. The library however only considers unhandled exceptions, and errors encountered while parsing the wire payload as use-cases that invoke the error handler. The expectation is that application specific errors will be dealt with by the user within their service definition.</p></header><nav class="odoc-toc"><ul><li><a href="#tutorial">Tutorial</a><ul><li><a href="#basics">Basics</a></li><li><a href="#streaming-response">Streaming response</a></li></ul></li><li><a href="#api-docs">API docs</a></li></ul></nav><div class="odoc-content"><h2 id="tutorial"><a href="#tutorial" class="anchor"></a>Tutorial</h2><h3 id="basics"><a href="#basics" class="anchor"></a>Basics</h3><p>Shuttle_http is not a framework and hence doesn't ship with any abstractions beyond service definitions needing to be a function that accept a request and return a deferred response.</p><p>A service definition in its most simple form might look like:</p><pre class="language-ocaml"><code>open Shuttle_http

let my_service (request : Request.t) =
  return (Response.create ~body:(Body.string &quot;Hello World&quot;) `Ok)
;;</code></pre><h3 id="streaming-response"><a href="#streaming-response" class="anchor"></a>Streaming response</h3><p>We saw how to define services that respond with data that's entirely in memory. For some use-cases (Specially when working with really large bodies created from external sources like files), one might want to use a streaming body to serve large amounts of data without loading it all in memory:</p><pre class="language-ocaml"><code>open Shuttle_http

let my_service (address : Socket.Address.Inet.t) (request : Request.t) =
  let%map reader =
    (* This an example to show a stream that works with an external resource. *)
    Reader.open_file &quot;&lt;some file path&gt;&quot;
  in
  (* Create a pipe from the reader that we will use as a streaming response body. *)
  let reader_pipe = Reader.pipe reader in
  (* Create a response from the reader's pipe. If the server is closed before the full
     response was served, the pipe will be closed which in-turn will close the reader and
     the underlying file descriptor. *)
  Response.create ~body:(Body.of_pipe `Chunked reader_pipe) `Ok
;;

let main port =
  Server.run_inet (Tcp.Where_to_listen.of_port port) my_service
;;</code></pre><h2 id="api-docs"><a href="#api-docs" class="anchor"></a>API docs</h2><p>The following modules are part of the library:</p><ul class="modules"><li><a href="Shuttle_http/Headers/index.html"><code>Shuttle_http.Headers</code></a> </li><li><a href="Shuttle_http/Meth/index.html"><code>Shuttle_http.Meth</code></a> </li><li><a href="Shuttle_http/Version/index.html"><code>Shuttle_http.Version</code></a> </li><li><a href="Shuttle_http/Body/index.html"><code>Shuttle_http.Body</code></a> </li><li><a href="Shuttle_http/Request/index.html"><code>Shuttle_http.Request</code></a> </li><li><a href="Shuttle_http/Status/index.html"><code>Shuttle_http.Status</code></a> </li><li><a href="Shuttle_http/Response/index.html"><code>Shuttle_http.Response</code></a> </li><li><a href="Shuttle_http/Server/index.html"><code>Shuttle_http.Server</code></a> </li><li><a href="Shuttle_http/Client/index.html"><code>Shuttle_http.Client</code></a> </li></ul></div></body></html>